<!DOCTYPE html>
<head>
  <title>Save It! secure your future</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> <!--Font Awesome by Dave Gandy - http://fontawesome.io-->
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="col-md-12 well">
    <h1><a href="/hello" class="black-text"> Save It!</a></h1>
    <h3>Save more money. Secure your future.</h3>
  </div>
  <div class="app container">
    <div class="row">
      <div class="col-sm-12 col-md-6">
	{% for goal in user.goals %}
	<div class="goal {% if goal.balance >= goal.target %}green{% endif %}">
	  <p class="goal-name">Goal: <span class="goalname">{{goal.name|title}}</span>
      <!--<span onClick="remove_goal()" class="remove-goal-button" id="remove-goal-button-{{ goal.name }}">x</span>-->
    </p>
    <!--script tags here
    var goalname = document.getElementsByClassName('goalname').innerHTML;
    goalname = goalname.toLowerCase()
    var button = document.getElementById("remove-goal-button-"+goalname);
    function remove_goal(){
      console.log("removing goal")
      event.preventDefault()
      console.log(goalname)
      document.getElementById("remove-goal-button-"+goalname).innerHTML = "two curly brackets del_goal(user, goal.name) "
    }
    script tags here-->
	  <div class="row">
	    <div class="col-sm-12 col-md-6">
	      <p class="goal-balance">Balance: ${{goal.balance}}</p>
	      <p class="goal-target">Target: ${{goal.target}}</p>
	    </div>
	    <div class="col-sm-12 col-md-6">
	      <div class="progress-bar">
		<div class="progress" style="width:{% if goal.balance < 0 %}0{% else %}{{goal.balance / goal.target * 100}}{% endif %}%"></div>
	    </div></div>
	  </div>
	</div>
	{% endfor %}
      </div>
      <div class="col-sm-12 col-md-6">
	<div id="message-window" class="message-wrapper">
	  {% for msg in user.messages %}
	  <div class="message {% if msg.from_user %}user{% else %}bot{% endif %}">
	    <p>{{msg.msg}}</p>
	  </div>
	  {% endfor %}
	</div>
	<div class="message-form">
	  <form action="/form">
	    <fieldset>
	      <input name="text" type="textarea" rows="5" cols="100" placeholder="Type your message here" value=""/>
	      <input type="submit" value="Send"/>
	    </fieldset>
	  </form>
	</div>
      </div>
    </div>
  </div>

</div>
<div class="container">
<hr>
<div class="row control-group">
  <div class="col-md-6 col-xs-12 col-sm-12 info">
      <h3 class="text-center">Commands</br>
      <i class="fa fa-terminal fa-5x"></i></h3>
      <p>Create and achieve goals, in your own words.
      <ul>
        <li>New Goal: "I want to buy a 500 dollar computer"</li>
        <li>Record Savings: "I put away 50 dollars for the computer"</li>
        <li>Record Withdrawls: "I had to withdraw 20 dollars against the computer"</li>
        <li>Delete Goal: "remove computer"
      </ul>
   </div>
  <div class="col-md-6 col-xs-12 col-sm-12 info">
      <h3 class="text-center">Your Progress</br>
      <i class="fa fa-line-chart fa-5x"></i></h3>
      <p>TODO</p>
  </div>
</div>
<hr>
</div>
<script>
  // tiny fix for scrolling: always show bottom messages
  const msgs = document.getElementById("message-window");
  msgs.scrollTop = msgs.scrollHeight;

  // render twitter links for the love of god
  const replaceTwitterLinks = function() {
  const twitter_regex = /(https:\/\/twitter\.com.+)/g;
  let messages = document.getElementsByTagName('p');
  messages = Array.from(messages);
  messages.forEach(function (m) {
  let t = m.innerHTML;
  console.log(t);
  twitter_link = t.match(twitter_regex)[0];
  console.log(twitter_link);
  if (match == null) { return; }
  let new_link = "Share on Twitter!".link(twitter_link);
  t.replace(twitter_regex,"");
  m.innerHTML = t;
  });
  }
</script>
</body>
